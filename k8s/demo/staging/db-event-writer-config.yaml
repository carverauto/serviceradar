apiVersion: v1
kind: ConfigMap
metadata:
  name: serviceradar-db-event-writer-config
data:
  db-event-writer.json: |
    {
      "listen_addr": "0.0.0.0:50041",
      "nats_url": "tls://serviceradar-nats:4222",
      "partition": "k8s",
      "stream_name": "events",
      "consumer_name": "db-event-writer",
      "agent_id": "k8s-db-event-writer",
      "gateway_id": "k8s-gateway",
      "streams": [
        {
          "subject": "events.gateway.health",
          "table": "events"
        },
        {
          "subject": "logs.syslog.processed", 
          "table": "logs"
        },
        {
          "subject": "logs.snmp.processed",
          "table": "logs"
        },
        {
          "subject": "logs.otel",
          "table": "logs"
        },
        {
          "subject": "otel.traces",
          "table": "otel_traces"
        },
        {
          "subject": "otel.metrics", 
          "table": "otel_metrics"
        },
        {
          "subject": "otel.metrics.raw",
          "table": "otel_metrics"
        }
      ],
      "cnpg": {
        "host": "cnpg-rw.demo-staging.svc.cluster.local",
        "port": 5432,
        "database": "telemetry",
        "username": "postgres",
        "password": "",
        "ssl_mode": "verify-full",
        "cert_dir": "/etc/serviceradar/certs",
        "tls": {
          "cert_file": "/etc/serviceradar/certs/db-event-writer.pem",
          "key_file": "/etc/serviceradar/certs/db-event-writer-key.pem",
          "ca_file": "/etc/serviceradar/certs/root.pem"
        }
      },
      "security": {
        "mode": "mtls",
        "cert_dir": "/etc/serviceradar/certs",
        "server_name": "localhost",
        "role": "core",
        "tls": {
          "cert_file": "/etc/serviceradar/certs/db-event-writer.pem",
          "key_file": "/etc/serviceradar/certs/db-event-writer-key.pem",
          "ca_file": "/etc/serviceradar/certs/root.pem"
        }
      },
      "nats_security": {
        "mode": "mtls",
        "cert_dir": "/etc/serviceradar/certs",
        "server_name": "nats.serviceradar",
        "role": "client",
        "tls": {
          "cert_file": "/etc/serviceradar/certs/db-event-writer.pem",
          "key_file": "/etc/serviceradar/certs/db-event-writer-key.pem",
          "ca_file": "/etc/serviceradar/certs/root.pem"
        }
      },
      "logging": {
        "level": "info",
        "debug": false,
        "output": "stdout",
        "time_format": "",
        "otel": {
          "enabled": true,
          "endpoint": "serviceradar-otel:4317",
          "service_name": "serviceradar-db-event-writer",
          "batch_timeout": "5s",
          "insecure": false,
          "headers": {},
          "tls": {
            "cert_file": "/etc/serviceradar/certs/db-event-writer.pem",
            "key_file": "/etc/serviceradar/certs/db-event-writer-key.pem",
            "ca_file": "/etc/serviceradar/certs/root.pem"
          }
        }
      }
    }
