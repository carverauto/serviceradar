image:
  repository: gcr.io/flame-public/buildbuddy-executor-enterprise
  tag: enterprise-v2.206.0
  imagePullPolicy: IfNotPresent

replicas: 3

autoscaler:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  averageQueueLength: 5

resources:
  requests:
    cpu: "8"
    memory: "16Gi"
    ephemeral-storage: "20Gi"
  limits:
    cpu: "16"
    memory: "32Gi"
    ephemeral-storage: "25Gi"

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: NotIn
              values:
                - k8s-cp3-worker3

extraVolumes:
  - name: cache-volume
    hostPath:
      path: /var/lib/buildbuddy/cache
      type: DirectoryOrCreate
  # Mount a Docker config with auth (secret must be created separately, e.g.
  # kubectl -n buildbuddy create secret docker-registry dockerhub-auth ...).
  - name: dockerhub-auth
    secret:
      secretName: dockerhub-auth
      items:
        - key: .dockerconfigjson
          path: config.json

extraVolumeMounts:
  - name: cache-volume
    mountPath: /cache
  - name: dockerhub-auth
    mountPath: /root/.docker
    readOnly: true

config:
  executor:
    app_target: grpcs://remote.buildbuddy.io:443
    enable_oci: true
    default_isolation_type: oci
    oci:
      mounts:
        - source: /cache
          destination: /cache
          type: bind
          options:
            - rbind
            - rw
    local_cache_directory: /cache
    local_cache_size_bytes: 50000000000
    root_directory: /cache/remotebuilds/
    api_key: ""
