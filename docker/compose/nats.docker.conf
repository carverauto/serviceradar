# NATS Server Configuration for ServiceRadar Docker Deployment
server_name: nats-serviceradar-docker

# Listen on all interfaces for Docker networking
listen: 0.0.0.0:4222

# HTTP monitoring
http: 0.0.0.0:8222

# Enable JetStream for KV store
jetstream {
  # Directory to store JetStream data
  store_dir: /data/jetstream
  # Maximum storage size
  max_memory_store: 1G
  # Maximum disk storage
  max_file_store: 10G
}

# Enable mTLS for secure communication
tls {
  # Path to the server certificate
  cert_file: "/etc/serviceradar/certs/nats.pem"
  # Path to the server private key
  key_file: "/etc/serviceradar/certs/nats-key.pem"
  # Path to the root CA certificate for verifying clients
  ca_file: "/etc/serviceradar/certs/root.pem"

  # Require client certificates (enables mTLS)
  verify: true
  # Require and verify client certificates
  verify_and_map: true
}

# Authorization for ServiceRadar components
authorization {
  users: [
    {
      user: "CN=core.serviceradar,O=ServiceRadar"
      permissions: {
        publish: {
          allow: [">"]
        }
        subscribe: {
          allow: [">"]
        }
      }
    },
    {
      user: "CN=poller.serviceradar,O=ServiceRadar"
      permissions: {
        publish: {
          allow: [">"]
        }
        subscribe: {
          allow: [">"]
        }
      }
    },
    {
      user: "CN=agent.serviceradar,O=ServiceRadar"
      permissions: {
        publish: {
          allow: [">"]
        }
        subscribe: {
          allow: [">"]
        }
      }
    }
  ]
}

# Logging settings
debug: false
trace: false