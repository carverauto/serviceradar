{{- $trustDomain := .Values.spire.trustDomain | default "carverauto.dev" -}}
{{- if .Values.checkerTemplates.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: serviceradar-checker-templates
data:
  sysmon.json: |
    {
      "listen_addr": "0.0.0.0:50083",
      "security": {
        "mode": "spiffe",
        "cert_dir": "/etc/serviceradar/certs",
        "trust_domain": "{{`{{TRUST_DOMAIN}}`}}",
        "workload_socket": "unix:/run/spire/sockets/agent.sock",
        "server_spiffe_id": "{{`{{DOWNSTREAM_SPIFFE_ID}}`}}"
      },
      "poll_interval": 30,
      "zfs": {
        "enabled": false,
        "pools": [],
        "include_datasets": false,
        "use_libzetta": false
      },
      "filesystems": [
        {
          "name": "/",
          "type": "ext4",
          "monitor": true
        }
      ]
    }
  sysmon-osx.json: |
    {
      "listen_addr": "0.0.0.0:50110",
      "security": {
        "mode": "spiffe",
        "cert_dir": "/etc/serviceradar/certs",
        "trust_domain": "{{`{{TRUST_DOMAIN}}`}}",
        "workload_socket": "unix:/run/spire/sockets/agent.sock",
        "server_spiffe_id": "{{`{{DOWNSTREAM_SPIFFE_ID}}`}}"
      },
      "sample_interval": "200ms"
    }
  snmp.json: |
    {
      "node_address": "{{`{{AGENT_ADDRESS}}`}}",
      "listen_addr": ":50054",
      "security": {
        "mode": "spiffe",
        "role": "checker",
        "cert_dir": "/etc/serviceradar/certs",
        "trust_domain": "{{`{{TRUST_DOMAIN}}`}}",
        "server_spiffe_id": "{{`{{DOWNSTREAM_SPIFFE_ID}}`}}",
        "workload_socket": "unix:/run/spire/sockets/agent.sock"
      },
      "timeout": "30s",
      "logger": {
        "level": "{{`{{LOG_LEVEL}}`}}",
        "debug": false,
        "output": "stdout"
      },
      "targets": []
    }
  rperf.json: |
    {
      "listen_addr": "0.0.0.0:50081",
      "name": "rperf-checker",
      "type": "grpc",
      "timeout": "30s",
      "security": {
        "mode": "spiffe",
        "cert_dir": "/etc/serviceradar/certs",
        "trust_domain": "{{`{{TRUST_DOMAIN}}`}}",
        "server_spiffe_id": "{{`{{DOWNSTREAM_SPIFFE_ID}}`}}",
        "workload_socket": "unix:/run/spire/sockets/agent.sock"
      },
      "default_poll_interval": 300,
      "targets": []
    }
  dusk.json: |
    {
      "name": "dusk",
      "type": "grpc",
      "node_address": "{{`{{AGENT_ADDRESS}}`}}",
      "listen_addr": ":50082",
      "timeout": "5m",
      "security": {
        "mode": "spiffe",
        "role": "checker",
        "cert_dir": "/etc/serviceradar/certs",
        "trust_domain": "{{`{{TRUST_DOMAIN}}`}}",
        "server_spiffe_id": "{{`{{DOWNSTREAM_SPIFFE_ID}}`}}",
        "workload_socket": "unix:/run/spire/sockets/agent.sock"
      }
    }
{{- end }}
